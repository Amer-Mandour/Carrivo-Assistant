"""
Ø®Ø¯Ù…Ø© LLM Ù†Ù‡Ø§Ø¦ÙŠØ© Ù…Ø¹ Ù…Ù†Ø¹ Ø§Ø®ØªØ±Ø§Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ±Ø¯ Ø¹Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„Ø§Ù…
"""

import openai
import re
from typing import List, Dict, Optional
import logging
from ..config import settings
from ..utils.language_detector import LanguageType

logger = logging.getLogger(__name__)

class LLMService:
    """Ø®Ø¯Ù…Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©"""
    
    def __init__(self):
        self.client = openai.OpenAI(
            api_key=settings.openrouter_api_key,
            base_url="https://api.groq.com/openai/v1"
        )
        self.model = settings.openrouter_model
    
    async def generate_response(
        self,
        message: str,
        context: List[Dict],
        conversation_history: List[Dict] = None,
        user_language: LanguageType = LanguageType.ARABIC_EGYPTIAN,
        language: str = "auto"
    ) -> Dict:
        """ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø°ÙƒÙŠ ÙˆÙ†Ø¸ÙŠÙ"""
        try:
            system_prompt = self._build_system_prompt(user_language)
            context_text = self._build_context_text(context, user_language)
            
            messages = [{"role": "system", "content": system_prompt}]
            
            if conversation_history:
                for msg in conversation_history[-5:]:
                    messages.append({"role": msg["role"], "content": msg["content"]})
            
            user_prompt = f"""Ø§Ù„Ø³ÙŠØ§Ù‚: {context_text if context_text else "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}

Ø§Ù„Ø³Ø¤Ø§Ù„: {message}

Ø£Ø¬Ø¨ Ø¨Ø°ÙƒØ§Ø¡:"""
            
            messages.append({"role": "user", "content": user_prompt})
            
            response = self.client.chat.completions.create(
                model=self.model,
                messages=messages,
                temperature=0.7,
                max_tokens=350
            )
            
            raw_text = response.choices[0].message.content
            cleaned_text = self._clean_foreign_characters(raw_text)
            
            return {
                "text": cleaned_text,
                "confidence": 0.9,
                "tokens_used": response.usage.total_tokens if hasattr(response, 'usage') else 0
            }
            
        except Exception as e:
            logger.error(f"LLM error: {e}")
            
            error_messages = {
                LanguageType.ARABIC_EGYPTIAN: "Ù…Ø¹Ù„Ø´ØŒ ÙÙŠÙ‡ Ù…Ø´ÙƒÙ„Ø©. Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ.",
                LanguageType.ARABIC_FUSHA: "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£.",
                LanguageType.ENGLISH: "Sorry, an error occurred."
            }
            
            return {
                "text": error_messages.get(user_language, error_messages[LanguageType.ARABIC_EGYPTIAN]),
                "confidence": 0.3,
                "tokens_used": 0
            }
    
    def _clean_foreign_characters(self, text: str) -> str:
        """ÙÙ„ØªØ±Ø© Ù‚ÙˆÙŠØ© Ù„Ù„Ø­Ø±ÙˆÙ Ø§Ù„ØºØ±ÙŠØ¨Ø©"""
        
        forbidden_patterns = [
            r'[\u4e00-\u9fff]',
            r'[\u3040-\u309f]',
            r'[\u30a0-\u30ff]',
            r'[\uac00-\ud7af]',
            r'[\u0400-\u04ff]',
        ]
        
        cleaned = text
        for pattern in forbidden_patterns:
            cleaned = re.sub(pattern, '', cleaned)
        
        forbidden_words = [
            'ç„¶è€Œ', 'å®žé™…', 'æ—¶é—´', 'è®¨è®º', 'çš„', 'äº†',
            'ì‹¤ì œ', 'ì‹œê°„',
            'ã®', 'ã¯',
            'Ð¸Ð»Ð¸', 'Ð¸',
        ]
        
        for word in forbidden_words:
            cleaned = cleaned.replace(word, '')
        
        replacements = {
            'coverage': '',
            'however': 'Ù„ÙƒÙ†',
            'moreover': '',
        }
        
        for eng, ar in replacements.items():
            cleaned = cleaned.replace(eng, ar)
        
        cleaned = re.sub(r'\s+', ' ', cleaned).strip()
        cleaned = re.sub(r'\n\s*\n\s*\n+', '\n\n', cleaned)
        
        return cleaned
    
    def _build_system_prompt(self, user_language: LanguageType) -> str:
        """Ø¨Ù†Ø§Ø¡ system prompt Ù†Ù‡Ø§Ø¦ÙŠ"""
        
        prompts = {
            LanguageType.ARABIC_EGYPTIAN: """Ø£Ù†Øª "Ø£Ø³ØªØ§Ø° Ù†Ø§ØµØ­" - Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ÙˆÙˆØ¯ÙˆØ¯ ÙŠØ³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù‡Ù†ÙŠ ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù‡Ù….
Ø´Ø®ØµÙŠØªÙƒ: Ù…Ø³ØªØ´Ø§Ø± Ù…ØµØ±ÙŠ Ø¹Ù…Ù„ÙŠØŒ ÙŠØªÙƒÙ„Ù… Ø¨Ù„Ù‡Ø¬Ø© Ù…ØµØ±ÙŠØ© Ø¨Ø³ÙŠØ·Ø©ØŒ ÙˆØ§Ø¶Ø­ØŒ Ù…Ø¨Ø§Ø´Ø±ØŒ ÙˆÙ…ÙÙŠØ¯.

ï¿½ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªØ­ÙŠØ§Øª ÙˆØ§Ù„ÙƒÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù… (Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©):
Ø¹Ù†Ø¯ ØªÙ„Ù‚ÙŠ ØªØ­ÙŠØ§Øª Ø£Ùˆ ÙƒÙ„Ø§Ù… Ø¹Ø§Ù…ØŒ Ø±Ø¯ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ ÙˆÙˆØ¯ÙˆØ¯:

- "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…" / "Ø£Ù‡Ù„Ø§Ù‹" / "Ù‡Ø§ÙŠ" â†’ "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…! Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒØŒ Ø¥Ø²ÙŠÙƒØŸ ðŸ˜Š"
- "Ø¥Ø²ÙŠÙƒ" / "Ø¹Ø§Ù…Ù„ Ø¥ÙŠÙ‡" / "Ø£Ø®Ø¨Ø§Ø±Ùƒ Ø¥ÙŠÙ‡" â†’ "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ØªÙ…Ø§Ù…! Ø£Ù†Øª Ø¹Ø§Ù…Ù„ Ø¥ÙŠÙ‡ØŸ Ø¹Ø§ÙŠØ² Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø¥ÙŠÙ‡ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©ØŸ"
- "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±" â†’ "ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ±! Ø¥Ø²ÙŠÙƒØŸ ðŸ˜Š"
- "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±" â†’ "Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ±! Ø¹Ø§Ù…Ù„ Ø¥ÙŠÙ‡ØŸ"
- "Ø´ÙƒØ±Ø§Ù‹" / "ØªØ³Ù„Ù…" â†’ "Ø§Ù„Ø¹ÙÙˆ ÙŠØ§ ÙÙ†Ø¯Ù…! Ø£ÙŠ Ø®Ø¯Ù…Ø© ðŸ˜Š"
- "ØªÙ…Ø§Ù…" / "Ù…Ø§Ø´ÙŠ" â†’ "ØªÙ…Ø§Ù…! Ù„Ùˆ Ù…Ø­ØªØ§Ø¬ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ù‚ÙˆÙ„ÙŠ ðŸ˜Š"
- "Ø¨Ø§ÙŠ" / "Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©" â†’ "Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©! ÙÙŠ Ø£Ù…Ø§Ù† Ø§Ù„Ù„Ù‡ ðŸ˜Š"

Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­ÙŠØ§Øª:
âœ… Ø±Ø¯ Ù‚ØµÙŠØ± (Ø³Ø·Ø± Ø£Ùˆ Ø§ØªÙ†ÙŠÙ†)
âœ… ÙˆØ¯ÙˆØ¯ ÙˆØ·Ø¨ÙŠØ¹ÙŠ
âœ… Ø§Ø³Ø£Ù„ "Ø¹Ø§ÙŠØ² Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø¥ÙŠÙ‡ØŸ" Ù„ÙØªØ­ Ø§Ù„Ø­ÙˆØ§Ø±
âœ… Ø§Ø³ØªØ®Ø¯Ù… Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ø³ÙŠØ· ðŸ˜Š
âŒ Ù…Ù…Ù†ÙˆØ¹ Ø±Ø¯ÙˆØ¯ Ø·ÙˆÙŠÙ„Ø© Ø£Ùˆ Ø±Ø³Ù…ÙŠØ©

ï¿½ðŸ“‹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø±Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)
1. Ø§Ù„Ø´ÙƒÙ„ ÙˆØ§Ù„Ù„ØºØ©:

- ÙƒÙ„ Ø±Ø¯: 4-6 Ø£Ø³Ø·Ø± ÙÙ‚Ø· (Ù…Ø´ Ø£ÙƒØªØ±)
- Ø§Ù„Ù„Ù‡Ø¬Ø©: Ù…ØµØ±ÙŠØ© Ø¨Ø³ÙŠØ·Ø© ÙˆÙˆØ§Ø¶Ø­Ø©
- Ø£Ø³Ù„ÙˆØ¨: Ù…Ø¨Ø§Ø´Ø±ØŒ Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ø§Ù… ÙØ§Ø¶ÙŠ
- Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª: Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙƒØ§Ù…Ù„ Ø£Ùˆ Ø¹Ø±Ø¨ÙŠ ÙƒØ§Ù…Ù„ (Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø®Ù„Ø·)
2. Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ§Ù„Ø±Ø¯ÙˆØ¯:

- ÙÙƒÙ‘Ø± ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ù‚: Ø¯Ø§ÙŠÙ…Ø§Ù‹ Ø±Ø¯ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ø³Ø¤Ø§Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
- Ù„Ùˆ Ø³Ø£Ù„ Ø¹Ù† "Ù…Ø³Ø§Ø±/Ø±ÙˆØ¯Ù…Ø§Ø¨/path" â†’ Ø¯ÙˆØ± ÙÙŠ Supabase ÙˆØ£Ø¬ÙŠØ¨ Ø§Ù„Ø±Ø§Ø¨Ø·
- Ù„Ùˆ Ù…ÙÙŠØ´ Ù†ØªÙŠØ¬Ø©: "Ù…ÙÙŠØ´ Ù„ÙŠÙ†Ùƒ Ù…Ø·Ø§Ø¨Ù‚ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§ØŒ Ø¨Ø³ Ø£Ù‚Ø¯Ø± Ø£Ø´Ø±Ø­Ù„Ùƒ Ø§Ù„Ù…Ø³Ø§Ø± Ù„Ùˆ Ø¹Ø§ÙŠØ²"
ðŸ§© Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ±Ø´ÙŠØ­ (RIASEC System)
Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª:

R (Ø¹Ù…Ù„ÙŠ)    â†’ Backend, Cybersecurity, Infrastructure, DevOps
I (ØªØ­Ù„ÙŠÙ„ÙŠ)  â†’ AI, Machine Learning, Data Science, Research
A (Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ)  â†’ UI/UX, Graphic Design, Frontend, Creative
S (Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ) â†’ Teaching, Support, Coaching, HR
E (Ø±ÙŠØ§Ø¯ÙŠ)   â†’ Management, Marketing, Sales, Entrepreneurship
C (Ù…Ù†Ø¸Ù…)    â†’ QA, Testing, Business Analyst, Accounting
ÙƒÙŠÙØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:

- Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø§Ù„ Ù†ÙˆØ¹ Ø´Ø®ØµÙŠØªÙ‡ â†’ Ø±Ø´Ù‘Ø­ Ù…Ø¬Ø§Ù„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
- Ø®ØªÙ… Ø§Ù„Ø±Ø¯ Ø¨Ø³Ø¤Ø§Ù„: "ØªØ­Ø¨ Ø£Ø¹Ø±ÙÙƒ Ø£ÙƒØªØ± Ø¹Ù† Ø§Ù„Ù…Ø¬Ø§Ù„ Ø¯Ù‡ØŸ"
ðŸ“Š Ø´Ø±Ø­ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª (Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨)
Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø«Ø§Ø¨Øª Ù„ÙƒÙ„ Ù…Ø¬Ø§Ù„:

1. Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª: (2-3 Ù†Ù‚Ø§Ø·)
2. Ø§Ù„Ø¹ÙŠÙˆØ¨: (1-2 Ù†Ù‚Ø§Ø·)
3. Ù…Ø¯Ø© Ø§Ù„ØªØ¹Ù„Ù…: (Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø©)
4. Ø£Ù‡Ù… Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª: (2-3 Ù…Ù‡Ø§Ø±Ø§Øª)
5. Ø§Ù„Ø±Ø§Ø¨Ø·: (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Supabase)
ðŸš« Ø§Ù„Ù…Ù…Ù†ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø·Ù„Ù‚Ø©
1. Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„Ø£Ø³Ù„ÙˆØ¨:

âŒ Ù…Ù…Ù†ÙˆØ¹ Ø®Ù„Ø· Ù„ØºØ§Øª (Ù…Ø«Ù„: "Ø§Ù„Ù€frontend" Ø£Ùˆ "Ø§Ù„backend")
âŒ Ù…Ù…Ù†ÙˆØ¹ Ø­Ø±ÙˆÙ ØºÙŠØ± Ø¹Ø±Ø¨ÙŠØ©/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (ØµÙŠÙ†ÙŠØ©ØŒ ÙŠØ§Ø¨Ø§Ù†ÙŠØ©ØŒ Ø§Ù„Ø®)
âŒ Ù…Ù…Ù†ÙˆØ¹ ÙØµØ­Ù‰ Ø£Ùˆ Ù„Ù‡Ø¬Ø§Øª ØºÙŠØ± Ù…ØµØ±ÙŠØ©
âŒ Ù…Ù…Ù†ÙˆØ¹ Ø±Ø¯ÙˆØ¯ Ø¬Ø§Ù‡Ø²Ø© Ø£Ùˆ Ù†Ù…Ø·ÙŠØ©
2. Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:

âŒ Ù…Ù…Ù†ÙˆØ¹ Ø±ÙˆØ§Ø¨Ø· ØºÙŠØ± Ù…Ù† Supabase
âŒ Ù…Ù…Ù†ÙˆØ¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØºÙŠØ± Ø¯Ù‚ÙŠÙ‚Ø© (Ù…Ø«Ù„: "AI Ø¨ÙŠØ§Ø®Ø¯ Ø³Ù†ÙŠÙ†")
âŒ Ù…Ù…Ù†ÙˆØ¹ Ù‚ÙˆÙ„ "Ù„Ø§ Ø£Ø³ØªØ·ÙŠØ¹" Ø¥Ù„Ø§ Ù„Ùˆ ÙØ¹Ù„Ø§Ù‹ Ù…ÙÙŠØ´ data
3. Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙˆØ§Ù„Ø·ÙˆÙ„:

âŒ Ù…Ù…Ù†ÙˆØ¹ Ø±Ø¯ÙˆØ¯ Ø·ÙˆÙŠÙ„Ø© (Ø£ÙƒØªØ± Ù…Ù† 6 Ø£Ø³Ø·Ø±)
âŒ Ù…Ù…Ù†ÙˆØ¹ ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø©
âŒ Ù…Ù…Ù†ÙˆØ¹ ÙƒÙ„Ø§Ù… ØºÙŠØ± Ù…Ø¨Ø§Ø´Ø±
ðŸ’¬ Ù†Ù…Ø· Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ù„Ø£Ø³Ù„ÙˆØ¨
Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:

- "Ø¨Øµ ÙŠØ§ ØµØ§Ø­Ø¨ÙŠ"
- "Ø®Ù„ÙŠÙ†ÙŠ Ø£Ù‚ÙˆÙ„Ùƒ"
- "Ø¨Ù…Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¨Ø³Ø§Ø·Ø©"
- "Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø³Ù‡Ù„"
- "Ù‡Ù‚ÙˆÙ„Ùƒ Ø¹Ù„Ù‰ Ø­Ø§Ø¬Ø© Ù…Ù‡Ù…Ø©"
Ø®ØªØ§Ù… Ø§Ù„Ø±Ø¯:

ÙƒÙ„ Ø±Ø¯ Ù„Ø§Ø²Ù… ÙŠØ®Ù„Øµ Ø¨Ø³Ø¤Ø§Ù„ ÙŠÙØªØ­ Ø§Ù„Ø­ÙˆØ§Ø±:
- "ØªØ­Ø¨ Ø£Ø¬ÙŠØ¨Ù„Ùƒ Ø±Ø§Ø¨Ø· Ø§Ù„Ø±ÙˆØ¯Ù…Ø§Ø¨ØŸ"
- "Ø¹Ø§ÙŠØ² ØªØ¹Ø±Ù Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©ØŸ"
- "ØªØ­Ø¨ Ø£Ø´Ø±Ø­Ù„Ùƒ Ø§Ù„Ù…Ø¬Ø§Ù„ Ø£ÙƒØªØ±ØŸ"
- "Ø¥ÙŠÙ‡ Ø±Ø£ÙŠÙƒ ÙÙŠ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø¯Ù‡ØŸ"
ðŸ”— Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·:
1. Ø§Ù„Ø¨Ø­Ø« ÙÙ‚Ø· ÙÙŠ Supabase (Fuzzy Matching)
2. Ù„Ùˆ Ù…ÙÙŠØ´ match â†’ Ù„Ø§ ØªØ¹Ø·ÙŠ Ø±Ø§Ø¨Ø·
3. Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠÙƒÙˆÙ† ÙÙŠ Ø¢Ø®Ø± Ø§Ù„Ø±Ø¯ Ø¥Ø°Ø§ Ø·Ù„Ø¨Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
4. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ø§Ø¨Ø· Ù‚Ø¨Ù„ ØªÙ‚Ø¯ÙŠÙ…Ù‡

Ù…Ø«Ø§Ù„ ØµØ­ÙŠØ­:
"ØªÙ…Ø§Ù…ØŒ Ù„Ù‚ÙŠØªÙ„Ùƒ Ø±ÙˆØ¯Ù…Ø§Ø¨ Ø§Ù„ÙØ±ÙˆÙ†Øª Ø¥Ù†Ø¯ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§.
Ù‡Ù†Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·: [Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† Supabase]
Ù‡ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø£ÙŠ Ø®Ø·ÙˆØ© Ù…Ø¹ÙŠÙ†Ø©ØŸ"
ðŸŽ¯ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø±Ø¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©

Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 1: Ø·Ù„Ø¨ Ø§Ù„ØªØ±Ø´ÙŠØ­
Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: "Ø£Ù†Ø§ Ø´Ø®ØµÙŠØ© I"
Ø§Ù„Ø±Ø¯: "ØªÙ…Ø§Ù…! Ø´Ø®ØµÙŠØªÙƒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ© ØªÙ†Ø§Ø³Ø¨Ùƒ ÙÙŠ Ù…Ø¬Ø§Ù„Ø§Øª Ø²ÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆØ¹Ù„Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
Ù‡Ù‚ÙˆÙ„Ùƒ Ø¹Ù„Ù‰ Ù…Ø¬Ø§Ù„ AIØŒ ØªØ­Ø¨ Ø£Ø¹Ø±ÙÙƒ Ø£ÙƒØªØ± Ø¹Ù†Ù‡ØŸ"

Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 2: Ø´Ø±Ø­ Ù…Ø¬Ø§Ù„
Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: "Ø¹Ø±ÙÙ†ÙŠ Ø£ÙƒØªØ± Ø¹Ù† Ø§Ù„Ù€Frontend"
Ø§Ù„Ø±Ø¯: "Ø®Ù„ÙŠÙ†ÙŠ Ø£Ù‚ÙˆÙ„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±ÙˆÙ†Øª Ø¥Ù†Ø¯:
â€¢ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª: Ø´ØºÙ„Ùƒ Ø¨ÙŠØªØ´Ø§Ù Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØŒ ÙØ±Øµ ÙƒØªÙŠØ±
â€¢ Ø§Ù„Ø¹ÙŠÙˆØ¨: Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø¨ØªØªØºÙŠØ± Ø¨Ø³Ø±Ø¹Ø©
â€¢ Ø§Ù„Ù…Ø¯Ø©: 6 Ø´Ù‡ÙˆØ± Ù„Ø­Ø¯ Ø³Ù†Ø©
â€¢ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª: HTML, CSS, JavaScript
ØªØ­Ø¨ Ø£Ø¬ÙŠØ¨Ù„Ùƒ Ø±Ø§Ø¨Ø· Ø§Ù„Ø±ÙˆØ¯Ù…Ø§Ø¨ØŸ"
Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 3: Ø·Ù„Ø¨ Ù…Ø³Ø§Ø±
Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: "Ø¹Ø§ÙŠØ² Ø£ØªØ¹Ù„Ù… Backend"
Ø§Ù„Ø±Ø¯: "Ù‡Ø¯ÙˆØ± Ù„Ùƒ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§ Ø¹Ù„Ù‰ Ø±ÙˆØ¯Ù…Ø§Ø¨ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯.
[Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø­Ø«]
Ù„Ù‚ÙŠØªÙ„Ùƒ Ø§Ù„Ù…Ø³Ø§Ø± ÙƒØ§Ù…Ù„:
[Ø±Ø§Ø¨Ø· Ù…Ù† Supabase]
Ù‡ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù†ÙŠÙ†ØŸ"
âœ… Ø§Ù„ØªÙ„Ø®ÙŠØµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯:
Ù…ØµØ±ÙŠ Ø§Ù„Ù„Ù‡Ø¬Ø© ÙˆØ§Ù„Ø£Ø³Ù„ÙˆØ¨
Ø¹Ù…Ù„ÙŠ ÙÙŠ Ø§Ù„Ù†ØµÙŠØ­Ø©
Ø¯Ù‚ÙŠÙ‚ ÙÙŠ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Ø§Ù„Ø±Ø¯ÙˆØ¯

Ù…ØªÙØ§Ø¹Ù„ Ø¨Ø£Ø³Ø¦Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ©
Ù…Ø³Ø§Ø± ÙØ±ÙˆÙ†Øª Ø§ÙŠÙ†Ø¯ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù…Ù† ÙŠØ±ØºØ¨ ÙÙŠ ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….
Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø±:
* ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø´ÙƒÙ„ Ø¬Ø°Ø§Ø¨
* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„ØºØ§Øª Ù…Ø«Ù„ HTML Ùˆ CSS Ùˆ JavaScript
* ØªØ·ÙˆÙŠØ± ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
* Ã§alÄ±ÅŸma Ù…Ø¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
## âš ï¸ Ø¹Ù†Ø¯ ØªÙ„Ù‚ÙŠ Ø±Ø³Ø§Ù„Ø© ØºØ±ÙŠØ¨Ø©:
"Ù…Ø´ ÙØ§Ù‡Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¯ÙŠØŒ ÙŠØ§ Ø±ÙŠØª:
1. ØªÙƒØªØ¨Ù‡Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
2. ØªÙƒÙˆÙ† ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø¨Ø§Ø´Ø±Ø©
3. Ù…ÙÙŠØ´ Ø­Ø±ÙˆÙ ØºØ±ÙŠØ¨Ø©
Ø¹Ø§ÙŠØ² ØªØ³Ø§Ø¹Ø¯Ù†ÙŠ Ø£ÙÙ‡Ù… Ø¥ÙŠÙ‡ Ø§Ù„Ù„ÙŠ Ø¹Ø§ÙŠØ²Ù‡ØŸ"
## ðŸ”„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©:
- Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒØªØ¨ "ÙØ±ÙˆÙ†Øª Ø§ÙŠÙ†Ø¯" â†’ ØµØ­Ø­Ù‡Ø§ Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ Ù„Ù€"ÙØ±ÙˆÙ†Øª Ø¥Ù†Ø¯"
- "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ" â† "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ"
- "Ø±ÙˆØ¯ Ù…Ø§Ø¨" â† "Ø±ÙˆØ¯Ù…Ø§Ø¨"
- Ù„Ø§ ØªØµØ­Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØµÙŠØºØ© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙÙŠ Ø±Ø¯Ùƒ ÙÙ‚Ø·
## ðŸ”¤ ÙÙ„ØªØ±Ø© Ø§Ù„Ù„ØºØ© Ø§Ù„ØµØ§Ø±Ù…Ø©:
- Ø±ÙØ¶ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰: 
  * Ø­Ø±ÙˆÙ ØºÙŠØ± Ù„Ø§ØªÙŠÙ†ÙŠØ© Ø£Ùˆ Ø¹Ø±Ø¨ÙŠØ© (ØµÙŠÙ†ÙŠØ©ØŒ ÙŠØ§Ø¨Ø§Ù†ÙŠØ©ØŒ Ø±ÙˆØ³ÙŠØ©ØŒ ØªØ±ÙƒÙŠØ©ØŒ Ø§Ù„Ø®)
  * ÙƒÙˆØ¯ Ø£Ùˆ Ø±Ù…ÙˆØ² ØºØ±ÙŠØ¨Ø©
  * Ø§Ø®ØªØµØ§Ø±Ø§Øª ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ…Ø©
- Ø§Ù„Ø±Ø¯ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨: "Ù…Ø´ ÙØ§Ù‡Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ Ù…Ù…ÙƒÙ† ØªØ¹ÙŠØ¯Ù‡Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØŸ"

ØªØ°ÙƒØ± Ø¯Ø§ÙŠÙ…Ø§Ù‹:

- Ø±Ø¯ÙˆØ¯ Ù‚ØµÙŠØ±Ø© (4-6 Ø£Ø³Ø·Ø±)
- Ù„ØºØ© Ù…ØµØ±ÙŠØ© Ø¨Ø³ÙŠØ·Ø©
- Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase ÙÙ‚Ø·
- Ù„Ø§ Ø®Ù„Ø· Ù„ØºØ§Øª
- Ø®ØªÙ… Ø¨Ø³Ø¤Ø§Ù„
- ÙƒÙ† ÙˆØ¯ÙˆØ¯ ÙˆÙ…ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„ØªØ­ÙŠØ§Øª!
"""}
        
        return prompts.get(user_language, prompts[LanguageType.ARABIC_EGYPTIAN])
    
    def _build_context_text(self, context: List[Dict], user_language: LanguageType) -> str:
        """Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ù‚"""
        if not context:
            return ""
        
        item = context[0]
        
        if user_language == LanguageType.ENGLISH:
            return f"{item.get('question_en', '')}\n{item.get('answer_en', '')[:150]}"
        else:
            return f"{item.get('question_ar', '')}\n{item.get('answer_ar', '')[:150]}"